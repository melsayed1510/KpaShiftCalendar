<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">

<!-- Bootstrap RTL -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<style>

/* =============================
   إعدادات عامة للصفحة
=============================*/
body{
    font-family:'Cairo';
    background:#f4f6f9;
    margin:10px;
}

/* =============================
   تنسيق الجدول
=============================*/
table{
    width:100%;
    border-collapse:collapse;
    table-layout:fixed;
}

td{
    font-size: clamp(8px, 0.7vw, 13px);
    padding:4px 2px;
    text-align:center;
    vertical-align:middle;
    border:1px solid #777;
    font-weight:700;
}

/* =============================
   خلية اسم الشهر
=============================*/
.monthCell{
    width:90px;
    font-size:18px;
    background:#e0e0e0;
    position: relative;
    padding:0;
}

.monthLabel{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:18px;
}

/* =============================
   ألوان الصفوف
=============================*/
.dateRow{background:#f1f1f1}
.dayRow{background:#fafafa}

/* ألوان النوبات */
.A{background:#f6c1c1}
.B{background:#c7eac7}
.C{background:#f6e2b3}
.empty{background:#ececec}

/* =============================
   عنوان الجدول
=============================*/
#title{
    margin:5px 0 15px 0;
    text-align:center;
    font-size:22px;
    font-weight:700;
    padding-bottom:10px;
    border-bottom:2px solid #ddd;
}

/* =============================
   الشريط العلوي
=============================*/
.topbar{
    background:white;
    padding:0px;
    box-shadow:0 2px 10px rgba(0,0,0,.1);
    margin-bottom:20px;
    text-align:center;
}

.form-control{font-weight:700;}
.controls{
   direction:ltr;
   padding: 10px; 
}

/* =============================
   الفوتر
=============================*/
.footer{
    border-top:1px solid #ddd;
    padding:10px;
    text-align:center;
    font-size:13px;
    color:#666;
    background:#fafafa;
}

.icon{
    width:16px;
    margin:0 6px;
    vertical-align:middle;
    opacity:.7;
}
.icon:hover{opacity:1;}

@media print{
    .social-icons{display:none !important;}
}

/* =============================
   زر التحميل
=============================*/
.pdf-circle-btn{
    width:50px;
    height:50px;
    border-radius:50%;
    border:2px solid #d5d5d5;
    background:#f4f6f9;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:.25s ease;
    color:#8a8f96;
    font-size:14px;
}

.pdf-circle-btn i{
    font-size:18px;
    line-height:1;
}

.pdf-circle-btn span{
    font-size:9px;
    font-weight:700;
    margin-top:-2px;
    letter-spacing:.5px;
}

.pdf-circle-btn:hover{
    background:#e9eef6;
    color:#1F5FA8;
    border-color:#1F5FA8;
    transform:translateY(-2px);
}

.pdf-circle-btn:active{
    transform:scale(.95);
}


</style>
</head>

<body>

<!-- =============================
     شريط التحكم العلوي
=============================-->
<div class="topbar">
<div class="controls d-flex justify-content-center gap-3 mb-3">

<input type="number" id="year" class="form-control w-auto">

<button class="pdf-circle-btn" onclick="exportScreenshotPDF()" title="Download PDF">
    <i class="bi bi-cloud-arrow-down"></i>
    <span>PDF</span>
</button>




</div>
</div>

<!-- =============================
     منطقة الطباعة
=============================-->
<div id="printArea">

<div id="title"></div>
<table id="table"></table>

<footer class="footer">
<span id="footerText"></span>
<strong> Mohamed Elsayed </strong>

<span class="social-icons">
<a href="https://www.instagram.com/m.elsayed1510/" target="_blank">
<img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/instagram.svg" class="icon">
</a>

<a href="https://www.facebook.com/mohamed.elsayed.mtwaly/" target="_blank">
<img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/facebook.svg" class="icon">
</a>
</span>

</footer>


</div>

<!-- مكتبات التصدير -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>

/* =============================
   اللغة من الصفحة الرئيسية
=============================*/
const params = new URLSearchParams(window.location.search);
const urlLang = params.get("lang") || "ar";
document.documentElement.dir = (urlLang==="ar")?"rtl":"ltr";

/* =============================
   إعدادات عامة
=============================*/
const BASE_DATE = new Date(2026,0,1);

const monthsAR=["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"];
const monthsEN=["January","February","March","April","May","June","July","August","September","October","November","December"];

const daysAR=["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
const daysEN=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

/* =============================
   حساب النوبة
=============================*/
function getShift(date){
let diff=Math.floor((date-BASE_DATE)/(1000*60*60*24));
return ["A","B","C"][(diff%3+3)%3];
}

/* =============================
   توليد الجدول
=============================*/
function generate(){

let year=document.getElementById("year").value;
let lang=urlLang;

let months=(lang==="ar")?monthsAR:monthsEN;
let days=(lang==="ar")?daysAR:daysEN;

document.getElementById("title").innerText=
lang==="ar"
?`جدول نوبات إدارة صيانة المعدات - ميناء الشعيبة - لسنة ${year}`
:`Shift Schedule - Shuaiba Port Maintenance Dept - ${year}`;

let table=document.getElementById("table");
table.innerHTML="";

for(let m=0;m<12;m++){

let r1=table.insertRow();
let r2=table.insertRow();
let r3=table.insertRow();

r1.className="dateRow";
r2.className="dayRow";

let monthCell=r1.insertCell();
monthCell.rowSpan=3;
monthCell.className="monthCell";
monthCell.innerHTML="<span class='monthLabel'>"+months[m]+"</span>";

let totalDays=new Date(year,m+1,0).getDate();

for(let d=1;d<=31;d++){

let c1=r1.insertCell();
let c2=r2.insertCell();
let c3=r3.insertCell();

if(d<=totalDays){

let date=new Date(year,m,d);

if(lang==="ar"){
c1.innerText="\u200E"+(m+1)+"-"+d;
}else{
c1.innerText=d+"-"+(m+1);
}

c2.innerText=days[date.getDay()];

let shift=getShift(date);
c3.innerText=shift;
c3.className=shift;

}else{
c1.className=c2.className=c3.className="empty";
}
}
}

document.getElementById("footerText").innerText=
lang==="ar"?"تم التصميم والتطوير بواسطة":"Designed & Developed by";
}


// ضبط السنة تلقائياً من تاريخ الجهاز
document.getElementById("year").value =
    new Date().getFullYear();

    
generate();
document.getElementById("year").onchange=generate;

/* =============================
   تصدير PDF
=============================*/
function exportScreenshotPDF(){

const { jsPDF } = window.jspdf;
const element = document.getElementById("printArea");

html2canvas(element,{scale:5,useCORS:true,backgroundColor:"#fff"}).then(canvas=>{

const imgData = canvas.toDataURL("image/jpeg",1);
const pdf = new jsPDF("landscape","mm","a4");

const margin = 7;
const pageWidth = pdf.internal.pageSize.getWidth() - margin*2;
const imgWidth = pageWidth;
const imgHeight = canvas.height * imgWidth / canvas.width;

let heightLeft = imgHeight;
let position = margin;

pdf.addImage(imgData,"JPEG",margin,position,imgWidth,imgHeight);
heightLeft -= pdf.internal.pageSize.getHeight() - margin*2;

while(heightLeft > 0){
    position = heightLeft - imgHeight + margin;
    pdf.addPage();
    pdf.addImage(imgData,"JPEG",margin,position,imgWidth,imgHeight);
    heightLeft -= pdf.internal.pageSize.getHeight() - margin*2;
}

/* ========= تحديد اللغة ========= */
const params = new URLSearchParams(window.location.search);
const lang = params.get("lang") || document.getElementById("lang").value || "ar";

/* ========= تحديد السنة ========= */
const year = document.getElementById("year").value;

/* ========= اسم الملف ========= */
let fileName;

if(lang === "ar"){
    fileName = `جدول-نوبات-${year}.pdf`;
}else{
    fileName = `Shift-Schedule-${year}.pdf`;
}

pdf.save(fileName);

});
}


document.getElementById("pdfText").innerText =
    (urlLang === "ar") ? "تحميل" : "Download";

</script>

</body>
</html>
